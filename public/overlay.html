<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OBS Ticker</title>
<style>
body {
    margin: 0;
    background: transparent;
    overflow: hidden;
    font-family: monospace;
}

.ticker-container {
    position: relative;
    width: 100%;
    height: 50px; /* Adjust height as needed */
    overflow: hidden;
}

.ticker-text {
    font-size: 36px;
    color: #00ff00;
    text-shadow: 2px 2px 4px black;
    white-space: nowrap;
    position: absolute;
    left: 0;
    top: 50%;
    will-change: transform;
    backface-visibility: hidden;
    -webkit-font-smoothing: antialiased;
    transform: translateZ(0);
}
</style>
</head>
<body>
<div class="ticker-container">
    <div class="ticker-text" id="ticker">Welcome to the Stream!</div>
</div>

<script>
const ticker = document.getElementById('ticker');

// Full-width continuous scrolling
let containerWidth = window.innerWidth;
let tickerWidth = ticker.offsetWidth;
let position = containerWidth;
let speed = 1.5;
let lastTime = 0;

// Duplicate for smooth looping
const duplicate = ticker.cloneNode(true);
duplicate.id = 'ticker-duplicate';
ticker.parentNode.appendChild(duplicate);

function scrollTicker(currentTime) {
    if (!lastTime) lastTime = currentTime;
    const deltaTime = currentTime - lastTime;
    lastTime = currentTime;
    
    // Use deltaTime for consistent animation speed regardless of framerate
    const moveDistance = speed * (deltaTime / 16.67); // 16.67ms = 60fps baseline
    position -= moveDistance;
    
    if(position < -tickerWidth - 100) {
        position = containerWidth;
    }
    
    // Use transform3d for better GPU acceleration
    ticker.style.transform = `translate3d(${Math.round(position)}px, -50%, 0)`;
    duplicate.style.transform = `translate3d(${Math.round(position + tickerWidth + 100)}px, -50%, 0)`;
    
    requestAnimationFrame(scrollTicker);
}

// Handle resize
window.addEventListener('resize', () => {
    containerWidth = window.innerWidth;
    tickerWidth = ticker.offsetWidth;
    position = containerWidth;
});

requestAnimationFrame(scrollTicker);

// Socket.io for real-time updates
const script = document.createElement('script');
script.src = '/socket.io/socket.io.js';
script.onload = function() {
    const socket = io();
    const urlParams = new URLSearchParams(window.location.search);
    const room = urlParams.get('room') || 'default';
    
    // Join room
    socket.emit('join', room);
    
    // Listen for updates from control panel
    socket.on('update', (data) => {
        if(data.text) {
            ticker.textContent = data.text;
            duplicate.textContent = data.text;
            // Wait a frame for the DOM to update before measuring
            requestAnimationFrame(() => {
                tickerWidth = ticker.offsetWidth;
                position = containerWidth;
            });
        }
        if(data.color) {
            ticker.style.color = data.color;
            duplicate.style.color = data.color;
        }
        if(data.fontSizePx) {
            ticker.style.fontSize = data.fontSizePx + 'px';
            duplicate.style.fontSize = data.fontSizePx + 'px';
        }
        if(data.fontFamily) {
            ticker.style.fontFamily = data.fontFamily;
            duplicate.style.fontFamily = data.fontFamily;
        }
        if(data.speed) {
            // Convert px/sec to pixels per frame at 60fps
            speed = data.speed / 60;
        }
    });
};
document.head.appendChild(script);
</script>
</body>
</html>
